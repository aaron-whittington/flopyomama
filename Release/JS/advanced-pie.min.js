(function(){function B(m,r,s,k,d,b){function B(D,d,x,b,a,h){var f=Math.PI/180;h=D+x*Math.cos(-b*f);var g=D+x*Math.cos(-a*f),e=D+x/2*Math.cos(-(b+(a-b)/2)*f),c=d+x*Math.sin(-b*f),k=d+x*Math.sin(-a*f),f=d+x/2*Math.sin(-(b+(a-b)/2)*f),m=[];m.path=["M",D,d,"L",h,c,"A",x,x,0,+(180<Math.abs(a-b)),1,g,k,"z"];m.middle={x:e,y:f};return m}function F(b,d,a,e,n,h,f){var g=Math.PI/180;f=b+a*Math.cos(-n*g);var c=b+a*Math.cos(-h*g),k=b+a/2*Math.cos(-(n+(h-n)/2)*g),m=d+a*Math.sin(-n*g),q=d+a*Math.sin(-h*g),l=d+a/
2*Math.sin(-(n+(h-n)/2)*g),r=b+e*Math.cos(-n*g);b+=e*Math.cos(-h*g);Math.cos(-(n+(h-n)/2)*g);var s=d+e*Math.sin(-n*g);d+=e*Math.sin(-h*g);Math.sin(-(n+(h-n)/2)*g);g={};g.path=["M",f,m,"A",a,a,0,+(180<Math.abs(h-n)),1,c,q,"L",b,d,"A",e,e,0,+(180<Math.abs(h-n)),0,r,s,"z"];g.middle={x:k,y:l};return g}b=b||{};var z=this,E=[],u=m.set(),c=m.set(),v=m.set(),w=d.length,p=0,q=0,A=0,l=b.maxSlices||100,e=parseFloat(b.minPercent)||1,t=Boolean(e);c.covers=u;if(1==w)v.push(m.circle(r,s,k).attr({fill:b.colors&&
b.colors[0]||z.colors[0],stroke:b.stroke||"#fff","stroke-width":null==b.strokewidth?1:b.strokewidth})),u.push(m.circle(r,s,k).attr(z.shim)),q=d[0],d[0]={value:d[0],order:0,valueOf:function(){return this.value}},b.href&&b.href[0]&&u[0].attr({href:b.href[0]}),v[0].middle={x:r,y:s},v[0].mangle=180;else{for(var a=0;a<w;a++)q+=d[a],d[a]={value:d[a],order:a,valueOf:function(){return this.value}};d.sort(function(b,d){return d.value-b.value});for(a=0;a<w;a++)t&&100*d[a]/q<e&&(l=a,t=!1),a>l&&(t=!1,d[l].value+=
d[a],d[l].others=!0,A=d[l].value);w=Math.min(l+1,d.length);A&&d.splice(w)&&(d[l].others=!0);for(a=0;a<w;a++){A=p-360*d[a]/q/2;a||(p=90-A,A=p-360*d[a]/q/2);if(b.init)var H=B(r,s,1,p,p-360*d[a]/q).join(",");for(var l=B(r,s,k/1.3,p,p-360*d[a]/q),e=[10,5,10],y=t=0;y<e.length;y++)t+=e[y];for(var C=p,G,y=0;y<e.length;y++)G=C-360*d[a]/q*e[y]/t,C=F(r,s,k/1.3+1,k,C,G),l.path=l.path.concat(C.path),C=G;p-=360*d[a]/q;e=b.matchColors&&!0==b.matchColors?d[a].order:a;e=m.path(b.init?H:l.path).attr({fill:b.colors&&
b.colors[e]||z.colors[e]||"#666",stroke:b.stroke||"#fff","stroke-width":null==b.strokewidth?1:b.strokewidth,"stroke-linejoin":"round"});e.value=d[a];e.middle=l.middle;e.mangle=A;E.push(e);v.push(e);b.init&&e.animate({path:l.join(",")},+b.init-1||1E3,">")}for(a=0;a<w;a++)e=m.path(E[a].attr("path")).attr(z.shim),b.href&&b.href[a]&&e.attr({href:b.href[a]}),e.attr=function(){},u.push(e),v.push(e)}c.hover=function(b,a){a=a||function(){};for(var e=this,c=0;c<w;c++)(function(c,h,f){var g={sector:c,cover:h,
cx:r,cy:s,mx:c.middle.x,my:c.middle.y,mangle:c.mangle,r:k,value:d[f],total:q,label:e.labels&&e.labels[f]};h.mouseover(function(){b.call(g)}).mouseout(function(){a.call(g)})})(v[c],u[c],c);return this};c.each=function(b){for(var a=0;a<w;a++){var c=v[a];b.call({sector:c,cover:u[a],cx:r,cy:s,x:c.middle.x,y:c.middle.y,mangle:c.mangle,r:k,value:d[a],total:q,label:this.labels&&this.labels[a]})}return this};c.click=function(a){for(var b=this,c=0;c<w;c++)(function(c,e,h){var f={sector:c,cover:e,cx:r,cy:s,
mx:c.middle.x,my:c.middle.y,mangle:c.mangle,r:k,value:d[h],total:q,label:b.labels&&b.labels[h]};e.click(function(){a.call(f)})})(v[c],u[c],c);return this};c.inject=function(a){a.insertBefore(u[0])};E=function(a,e,l,p){var n=r+k+k/5,h=s+10;a=a||[];p=p&&p.toLowerCase&&p.toLowerCase()||"east";l=m[l&&l.toLowerCase()]||"circle";c.labels=m.set();for(var f=0;f<w;f++){var g=v[f].attr("fill"),t=d[f].order;d[f].others&&(a[t]=e||"Others");a[t]=z.labelise(a[t],d[f],q);c.labels.push(m.set());c.labels[f].push(m[l](n+
5,h,5).attr({fill:g,stroke:"none"}));c.labels[f].push(g=m.text(n+20,h,a[t]||d[t]).attr(z.txtattr).attr({fill:b.legendcolor||"#000","text-anchor":"start"}));u[f].label=c.labels[f];h+=1.2*g.getBBox().height}a=c.labels.getBBox();c.labels.translate.apply(c.labels,{east:[0,-a.height/2],west:[-a.width-2*k-20,-a.height/2],north:[-k-a.width/2,-k-a.height-10],south:[-k-a.width/2,k+10]}[p]);c.push(c.labels)};b.legend&&E(b.legend,b.legendothers,b.legendmark,b.legendpos);c.push(v,u);c.series=v;c.covers=u;return c}
var F=function(){};F.prototype=Raphael.g;B.prototype=new F;Raphael.fn.advancedPiechart=function(m,r,s,k,d){return new B(this,m,r,s,k,d)}})();
